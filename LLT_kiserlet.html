<!DOCTYPE html>
<html>
<head>
  <script src="jspsych-psychophysics-2.0/jspsych.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-instructions.js"></script>
  <script src="jspsych-psychophysics-2.0/jspsych-psychophysics.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jsPsych-6.3.1/plugins/jspsych-fullscreen.js"></script>
  <script src="jsPsych-6.3.1/plugins/jspsych-survey-multi-choice.js"></script>
  <script src="jsPsych-6.3.1/plugins/jspsych-html-keyboard-response.js"></script>
  <script src="jsPsych-6.3.1/plugins/jspsych-preload.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-survey-text.js"></script>
  <script src="jspsych-6.3.1/plugins/jspsych-survey-html-form.js"></script>


  <link rel="stylesheet" href="jspsych-psychophysics-2.0/css/jspsych.css"></link>
  <link rel="stylesheet" href="custom_style.css"></link>


</head>
<body></body>
<script>
//Setup
document.addEventListener('contextmenu', event => event.preventDefault());

function changeBackground(color) {
  document.body.style.background = color;
}

window.addEventListener("load",function() { changeBackground('black') });

var text_color = "white"

var timeline = []

//Stimuli for distractor task
var maths_list_og = []
for (x=0; x < 10; x++){
  for (y=0; y < 10; y++){
    x_str = x.toString()
    y_str = y.toString()
    maths_list_og.push({num_1: x_str, num_2: y_str});
  }
}
maths_list_random = jsPsych.randomization.shuffle(maths_list_og)
maths_list = maths_list_random.splice(80)
console.log(maths_list)

//Picture size
var picture_width = window.innerWidth/100*8
var picture_height = window.innerHeight/100*13

//Coordinates for easy adjustment
var space_horizontal = 1 //Horizontal spacing between pictures
var space_vertical = 1 //Vertical spacing between pictures

var X_first = window.innerWidth/100*26
var X_second = X_first + picture_width + space_horizontal
var X_third = X_second + picture_width + space_horizontal
var X_fourth = X_third + picture_width + space_horizontal
var X_fifth = X_fourth + picture_width + space_horizontal
var X_sixth = X_fifth + picture_width + space_horizontal

var Y_first = window.innerHeight/100*20
var Y_second = Y_first + picture_height + space_vertical
var Y_third = Y_second + picture_height + space_vertical
var Y_fourth = Y_third + picture_height + space_vertical
var Y_fifth = Y_fourth + picture_height + space_vertical
var Y_sixth = Y_fifth + picture_height + space_vertical

//List for preloading
let all_images = ["ListPractice/1.bmp", "ListPractice/2.bmp", "ListPractice/3.bmp", "ListPractice/4.bmp", "ListPractice/5.bmp", "ListPractice/6.bmp", "List1/1.bmp", "List1/5.bmp", "List1/7.bmp","List1/8.bmp","List1/9.bmp", "List1/10.bmp", "List1/11.bmp", "List1/13.bmp", "List1/14.bmp", "List1/15.bmp", "List1/16.bmp", "List1/17.bmp", "List1/18.bmp", "List1/19.bmp", "List1/21.bmp", "List1/22.bmp", "List1/23.bmp", "List1/24.bmp", "List1/25.bmp", "List1/26.bmp", "List1/27.bmp", "List1/28.bmp", "List1/29.bmp", "List1/30.bmp"];

//lists for practice
let practice_picture_list_1 = [
  {stimulus: "ListPractice/2.bmp", X: X_second, Y: Y_fourth},
  {stimulus: "ListPractice/3.bmp", X: X_fifth, Y: Y_second},
  {stimulus: "ListPractice/4.bmp", X: X_first, Y: Y_third},
]

let practice_recall_list_1 = [
  {stimulus: "List1/28.bmp", left_X: window.innerWidth/100*49, right_X: window.innerWidth/100*49 + picture_width, top_Y: window.innerHeight/100*53, bottom_Y: window.innerHeight/100*53 +picture_height, was: 1},
  {stimulus: "ListPractice/4.bmp", left_X: X_first, right_X: X_first + picture_width, top_Y: Y_third, bottom_Y: Y_third + picture_height, was: 0},
  {stimulus: "ListPractice/2.bmp", left_X: X_second, right_X: X_second + picture_width, top_Y: Y_fourth, bottom_Y: Y_fourth + picture_height, was: 0},
  {stimulus: "List1/29.bmp", left_X: window.innerWidth/100*42, right_X: window.innerWidth/100*42 + picture_width, top_Y: window.innerHeight/100*53, bottom_Y: window.innerHeight/100*53 +picture_height, was: 1},
  {stimulus: "ListPractice/3.bmp", left_X: X_fifth, right_X: X_fifth + picture_width, top_Y: Y_second, bottom_Y: Y_second + picture_height, was: 0},
  {stimulus: "List1/30.bmp", left_X: window.innerWidth/100*56, right_X: window.innerWidth/100*56 + picture_width, top_Y: window.innerHeight/100*20, bottom_Y: window.innerHeight/100*20 +picture_height, was: 1},
] 

let practice_picture_list_2 = [
  {stimulus: "ListPractice/1.bmp", X: X_fourth, Y: Y_fourth},
  {stimulus: "ListPractice/5.bmp", X: X_fourth, Y: Y_first},
  {stimulus: "ListPractice/6.bmp", X: X_third, Y: Y_second},
]
let practice_recall_list_2 = [
  {stimulus: "List1/27.bmp", left_X: window.innerWidth/100*49, right_X: window.innerWidth/100*49 + picture_width, top_Y: window.innerHeight/100*53, bottom_Y: window.innerHeight/100*53 +picture_height, was: 1},
  {stimulus: "ListPractice/5.bmp", left_X: X_fourth, right_X: X_fourth + picture_width, top_Y: Y_first, bottom_Y: Y_first + picture_height, was: 0},
  {stimulus: "ListPractice/1.bmp", left_X: X_fourth, right_X: X_fourth + picture_width, top_Y: Y_fourth, bottom_Y: Y_fourth + picture_height, was: 0},
  {stimulus: "List1/26.bmp", left_X: window.innerWidth/100*42, right_X: window.innerWidth/100*42 + picture_width, top_Y: window.innerHeight/100*53, bottom_Y: window.innerHeight/100*53 +picture_height, was: 1},
  {stimulus: "ListPractice/6.bmp", left_X: X_third, right_X: X_third + picture_width, top_Y: Y_second, bottom_Y: Y_second + picture_height, was: 0},
  {stimulus: "List1/25.bmp", left_X: window.innerWidth/100*56, right_X: window.innerWidth/100*56 + picture_width, top_Y: window.innerHeight/100*20, bottom_Y: window.innerHeight/100*20 +picture_height, was: 1},
]

// lists for trials

//picture_list:

let place_X_order = [X_first, X_second, X_third, X_fourth, X_fifth, X_sixth]
let place_Y_order = [Y_first, Y_second, Y_third, Y_fourth, Y_fifth, Y_sixth]

let grid_list_order = []; //rács koordináták listája

for (x=0; x< place_X_order.length; x++){
  for (y=0; y<place_Y_order.length; y++){
    grid_list_order.push([place_X_order[x], place_Y_order[y]]);
  } //36 elemű lista, amely tartalmazza a koordináta párokat
}
console.log(grid_list_order);

let picture_call_order = ["List1/1.bmp", "List1/5.bmp", "List1/7.bmp","List1/8.bmp","List1/9.bmp", "List1/10.bmp", "List1/11.bmp", "List1/13.bmp", "List1/14.bmp", "List1/15.bmp", "List1/16.bmp", "List1/17.bmp", "List1/18.bmp", "List1/19.bmp", "List1/21.bmp", "List1/22.bmp", "List1/23.bmp", "List1/24.bmp", "List1/25.bmp", "List1/26.bmp", "List1/27.bmp", "List1/28.bmp", "List1/29.bmp", "List1/30.bmp", ]

let picture_list = [
  {stimulus: "List1/1.bmp", X: X_fourth, Y: Y_fourth},
  {stimulus: "List1/2.bmp", X: X_third, Y: Y_fifth},
  {stimulus: "List1/3.bmp", X: X_third, Y: Y_third},
  {stimulus: "List1/4.bmp", X: X_fourth, Y: Y_first},
  {stimulus: "List1/5.bmp", X: X_fifth, Y: Y_third},
  {stimulus: "List1/6.bmp", X: X_first, Y: Y_first},
  {stimulus: "List1/7.bmp", X: X_fifth, Y: Y_first},
  {stimulus: "List1/8.bmp", X: X_second, Y: Y_first},
  {stimulus: "List1/9.bmp", X: X_fourth, Y: Y_fifth},
  {stimulus: "List1/10.bmp", X: X_second, Y: Y_third},
  {stimulus: "List1/11.bmp", X: X_first, Y: Y_second},
  {stimulus: "List1/13.bmp", X: X_fourth, Y: Y_third},
  {stimulus: "List1/14.bmp", X: X_third, Y: Y_first},
  {stimulus: "List1/15.bmp", X: X_first, Y: Y_third},
]

//Randomization

//let grid_list = jsPsych.randomization.shuffle(grid_list_order);
//let picture_call = jsPsych.randomization.shuffle(picture_call_order) //randomizált képlista, ehelyett kell egy előre randomizált lista, ami ugyanaz lesz mindenkinél

/*let picture_list = []

function generate_picture_list(arr){
  for (i=0; i<12; i++){
      onerow = {stimulus: picture_call[i], X: grid_list_order[i][0], Y: grid_list_order[i][1]},
      arr.push(onerow)
    } //sorba helyezi az első 12 elemét a képlistának és koordinátalistának és beteszi a picture_list-be
}  

generate_picture_list(picture_list);
console.log(picture_list); */

// Recall_list: 

let recall_list =  [
  {stimulus: "List1/27.bmp", left_X: X_third, right_X: X_third + picture_width, top_Y: Y_fourth, bottom_Y: Y_fourth + picture_height, was: 1},
  {stimulus: "List1/15.bmp", left_X: X_first, right_X: X_first + picture_width, top_Y: Y_third, bottom_Y: Y_third + picture_height, was: 0},
  {stimulus: "List1/26.bmp", left_X: X_third, right_X: X_third + picture_width, top_Y: Y_fourth, bottom_Y: Y_fourth + picture_height, was: 1},
  {stimulus: "List1/14.bmp", left_X: X_third, right_X: X_third + picture_width, top_Y: Y_first, bottom_Y: Y_first + picture_height, was: 0},
  {stimulus: "List1/3.bmp", left_X: X_third, right_X: X_third + picture_width, top_Y: Y_third, bottom_Y: Y_third + picture_height, was: 0},
  {stimulus: "List1/25.bmp", left_X: X_first, right_X: X_first + picture_width, top_Y: Y_fifth, bottom_Y: Y_fifth + picture_height, was: 1},
  {stimulus: "List1/17.bmp", left_X: X_third, right_X: X_third + picture_width, top_Y: Y_second, bottom_Y: Y_second + picture_height, was: 1},
  {stimulus: "List1/19.bmp", left_X: X_fifth, right_X: X_fifth + picture_width, top_Y: Y_fourth, bottom_Y: Y_fourth + picture_height, was: 1},
  {stimulus: "List1/9.bmp", left_X: X_fourth, right_X: X_fourth + picture_width, top_Y: Y_fifth, bottom_Y: Y_fifth + picture_height, was: 0},
  {stimulus: "List1/21.bmp", left_X: X_third, right_X: X_third + picture_width, top_Y: Y_fourth, bottom_Y: Y_fourth + picture_height, was: 1},
  {stimulus: "List1/10.bmp", left_X: X_second, right_X: X_second + picture_width, top_Y: Y_third, bottom_Y: Y_third + picture_height, was: 0},
  {stimulus: "List1/8.bmp", left_X: X_second, right_X: X_second + picture_width, top_Y: Y_first, bottom_Y: Y_first + picture_height, was: 0},
  {stimulus: "List1/28.bmp", left_X: X_third, right_X: X_third + picture_width, top_Y: Y_fourth, bottom_Y: Y_fourth + picture_height, was: 1},
  {stimulus: "List1/23.bmp", left_X: X_fourth, right_X: X_fourth + picture_width, top_Y: Y_second, bottom_Y: Y_second + picture_height, was: 1},
  {stimulus: "List1/11.bmp", left_X: X_first, right_X: X_first + picture_width, top_Y: Y_second, bottom_Y: Y_second + picture_height, was: 0},
  {stimulus: "List1/5.bmp", left_X: X_fifth, right_X: X_fifth + picture_width, top_Y: Y_third, bottom_Y: Y_third + picture_height, was: 0},
  {stimulus: "List1/20.bmp", left_X: X_first, right_X: X_first + picture_width, top_Y: Y_fourth, bottom_Y: Y_fourth + picture_height, was: 1},
  {stimulus: "List1/29.bmp", left_X: X_third, right_X: X_third + picture_width, top_Y: Y_fourth, bottom_Y: Y_fourth + picture_height, was: 1},
  {stimulus: "List1/7.bmp", left_X: X_fifth, right_X: X_fifth + picture_width, top_Y: Y_first, bottom_Y: Y_first + picture_height, was: 0},
  {stimulus: "List1/16.bmp", left_X: X_second, right_X: X_second + picture_width, top_Y: Y_fifth, bottom_Y: Y_fifth + picture_height, was: 1},
  {stimulus: "List1/22.bmp", left_X: X_fifth, right_X: X_fifth + picture_width, top_Y: Y_second, bottom_Y: Y_second + picture_height, was: 1},
  {stimulus: "List1/6.bmp", left_X: X_first, right_X: X_first + picture_width, top_Y: Y_first, bottom_Y: Y_first + picture_height, was: 0},
  {stimulus: "List1/1.bmp", left_X: X_fourth, right_X: X_fourth + picture_width, top_Y: Y_fourth, bottom_Y: Y_fourth + picture_height, was: 0},
  {stimulus: "List1/24.bmp", left_X: X_fifth, right_X: X_fifth + picture_width, top_Y: Y_fifth, bottom_Y: Y_fifth + picture_height, was: 1},
  {stimulus: "List1/30.bmp", left_X: X_third, right_X: X_third + picture_width, top_Y: Y_fourth, bottom_Y: Y_fourth + picture_height, was: 1},
  {stimulus: "List1/2.bmp", left_X: X_third, right_X: X_third + picture_width, top_Y: Y_fifth, bottom_Y: Y_fifth + picture_height, was: 0},
  {stimulus: "List1/13.bmp", left_X: X_fourth, right_X: X_fourth + picture_width, top_Y: Y_third, bottom_Y: Y_third + picture_height, was: 0},
  {stimulus: "List1/4.bmp", left_X: X_fourth, right_X: X_fourth + picture_width, top_Y: Y_first, bottom_Y: Y_first + picture_height, was: 0},
  {stimulus: "List1/18.bmp", left_X: X_second, right_X: X_second + picture_width, top_Y: Y_fourth, bottom_Y: Y_fourth + picture_height, was: 1},
  {stimulus: "List1/12.bmp", left_X: X_third, right_X: X_third + picture_width, top_Y: Y_fourth, bottom_Y: Y_fourth + picture_height, was: 1},
]
      
/*
let recall_list = []
function generate_recall_list(array){
  for (i=0; i<30; i++){
    if (i<15){
      onerow = {stimulus: picture_call_order[i], left_X: grid_list[i][0], right_X: grid_list[i][0] + picture_width, top_Y: grid_list[i][1], bottom_Y: grid_list[i][1] + picture_height, was: 0},
      array.push(onerow);
    }
    else{
      onerow = {stimulus: picture_call_order[i], left_X: grid_list[i][0], right_X: grid_list[i][0] + picture_width, top_Y: grid_list[i][1], bottom_Y: grid_list[i][1] + picture_height, was: 2},
      array.push(onerow);
    }
  }
}
generate_recall_list(recall_list);
//let recall_list =  jsPsych.randomization.shuffle(recall_list_order); RANDOM LISTA GENERÁLÁSHOZ VALÓ KÓD, NEM HASZNÁLJUK
console.log(recall_list); */

    //Drawing objects
    var gray = {
      obj_type: 'image',
      file: 'gray_square.bmp',
      drawFunc: function(stimulus, canvas, context){
        for (i=0; i<grid_list_order.length; i++){
          context.drawImage(stimulus.img, grid_list_order[i][0], grid_list_order[i][1], picture_width, picture_height)
        } 
      }
    }

    var img_memorise = {
        obj_type: 'image',
        show_start_time: 1000,
        file: jsPsych.timelineVariable('stimulus'),
        drawFunc: function(stimulus, canvas, context){
            context.drawImage(stimulus.img, jsPsych.timelineVariable('X', true), jsPsych.timelineVariable('Y', true), picture_width, picture_height);
        }
    }

    var img_recall = {
        obj_type: 'image',
        file: jsPsych.timelineVariable('stimulus'),
        drawFunc: function(stimulus, canvas, context){
            context.drawImage(stimulus.img, X_first, Y_first*0.2, picture_width, picture_height);
        }
    }
    
    var text_seen = {
      obj_type: 'manual',
      drawFunc: function(stimulus, canvas, context){
        context.fillStyle=text_color;
        context.font='52px serif';
        context.fillText('Látta már ezt a képet?', X_second + picture_width*0.5, Y_first*0.6);
      }
    };

    var text_where = {
      obj_type: 'manual',
      drawFunc: function(stimulus, canvas, context){
        context.fillStyle=text_color;
        context.font='52px serif';
        context.fillText('Hol látta?', X_second + picture_width*0.5, Y_first*0.6);
      }
    };

    /* var text_response = {
      obj_type: 'manual',
      drawFunc: function(stimulus, canvas, context){
        context.fillStyle=text_color;
        context.font='26px serif';
        context.fillText('Bal egérgomb: láttam | Jobb egérgomb: nem láttam', window.innerWidth/100*32, window.innerHeight/100*90);
      }
    } */

    var text_feedback = {
      obj_type: 'manual',
      drawFunc: function(stimulus, canvas, context){
        x = jsPsych.data.getLastTimelineData().filter({correct_position: true}).count();
        context.fillStyle = text_color;
        context.font = '32px serif';
        context.fillText('Helyes válaszok száma: '+x, window.innerWidth/100*40, window.innerHeight/100*50);
      }
    }



    //Trials
    var consent_text_complete = `<h1 style="color:${text_color}">Tájékoztató és beleegyező nyilatkozat</h1><p style="color:${text_color}">Ez a kérdőív névtelen. A kérdőívre adott válaszokkal együtt nem rögzítünk semmilyen Önnel kapcsolatos azonosító információt, csak akkor, ha kimondottan ilyen adatra vonatkozó kérdésre válaszol a kérdőívben. Ha azonosító kitöltésjelszót használt ennek a kérdőívnek az eléréséhez, megnyugodhat, hogy ezt a kitöltésjelszót a válaszoktól elkülönítetten kezeljük. A kitöltésjelszót külön adatbázisban tároljuk, és csak azt jelzi, hogy a kitöltése befejeződött ill. még nem fejeződött be. A kitöltésjelszó semmilyen módon sem kapcsolható össze a kérdőív kérdéseire adott válaszokkal.</p><h2 style="color:${text_color}">ADATKEZELÉSI TÁJÉKOZTATÓ </h2><p style="color:${text_color}">A   beleegyező   nyilatkozat   az   EU   2016/679.   számú   általános   adatvédelmi   rendelete [GDPR], valamint az információs önrendelkezési jogról és az információszabadságról szóló 2011. évi CXII. törvény rendelkezései alapján lett összeállítva. Elfogadásával a GDPR preambulum (32)-(33), 4. cikk 11. pont, 6. cikk (1)a) pont alapján hozzájárul ahhoz, hogy azon személyes adatai, amelyek az elérhetőségét biztosítják a vizsgálat   elvégzéséig   (teljes   név,   telefonszám   és   e-mail   cím),   valamint   speciális egészségügyi adatai a törvényi előírásoknak megfelelően tárolásra kerüljenek. Személyes adatok   a   résztvevők   toborzásának   folyamatához   szükségesek,   az   esetleges későbbi vizsgálatok és azok eredményei anonim módon lesznek tárolva. Személyes adataihoz csak a titoktartási megállapodást elfogadó adatkezelők férhetnek hozzá, ameddig a teljes adat nem lesz anonimizálható. A   beleegyező   nyilatkozat   elfogadásával   továbbá   hozzájárul   ahhoz,   hogy   a   későbbi vizsgálat során végzett tesztek eredményei anonim módon rögzítésre kerüljenek, azt az illetékesek elektronikus úton tárolják, és kutatási célból felhasználják úgy, hogy harmadik fél   részére   személye   azonosítására   alkalmas   információt   nem   szolgáltatnak   ki. Anonimizált, személyes beazonosításra nem alkalmas adatai a tudományos közösség számára publikussá válnak a https://osf.io/  (Open Science Foundation [magyarul: Nyílt Tudomány Alapítvány]) és a https://openneuro.org/ (OpenNeuro) szerverein. A beleegyező nyilatkozatban kifejezett hozzájárulás bármikor visszavonható, amely tény nem érinti a visszavonás előtti adatkezelés jogszerűségét. A nyilvántartott személyes adatokhoz bármikor hozzáférhet, azok helyesbítését és törlését joggal kérvényezheti (GDPR 3/3/17). Továbbá jogosult arra, hogy az adatkezelőtől visszajelzést kapjon arra vonatkozóan,   hogy   személyes   adatainak   kezelése   folyamatban   van-e,   és   ha   ilyen adatkezelés folyamatban van, jogosult arra, hogy a személyes adatokhoz és a következő információkhoz   hozzáférést   kap  (GDPR 2/15/1). Kérésére   az  adatkezelő   indokolatlan késedelem nélkül helyesbíti a rá vonatkozó pontatlan személyes adatokat. Figyelembe véve az adatkezelés célját, jogosult arra, hogy kérje a hiányos személyes adatok – egyebek mellett kiegészítő nyilatkozat útján történő – kiegészítését is (GDPR 3/3/16). Adatvédelmi   panasz   esetén   joggal   fordulhat   a   Nemzeti   Adatvédelmi   és Információszabadság Hatósághoz (http://naih.hu postacím: 1530 Budapest, Pf.: 5., e-mail: ugyfelszolgalat@naih.hu, telefonszám: +36 (1) 391-1400). A fő adatkezelő elérhetősége és adatai: Név: Dr. Keresztes Attila Intézmény: Agyi Képalkotó Központ, Természettudományi Kutatóközpont Telefonszám: +36 1 3826903 E-mail cím: keresztes.attila.akk@ttk.hu </p><h2 style="color:${text_color}">BELEEGYEZŐ NYILATKOZAT </h2><p style="color:${text_color}">A kérdőívvel és az adatkezeléssel kapcsolatban minden számomra fontos információt megkaptam, a tájékoztatót elolvastam. A kérdőívet önszántamból, saját felelősségemre töltöm ki. Kérjük,  olvassa   el  az   alábbi   állításokat!   Amennyiben   egyetért   velük, jelölje   meg  az állítások alatt található négyzetet. Tudomásul  veszem,  hogy  a  kitöltés bármikor,  indoklás  nélkül, akár  végleg   is megszakítható,   és   ebben   az   esetben   a   megadott   adatok   nem   kerülnek feldolgozásra. Tudomásul veszem, hogy adataimat a 2018. május 25-től hatályos 2016/679/EU Európai Unió általános adatvédelmi irányelvét és a magyarországi jogszabályokat (2011. évi CXII. adatvédelmi tv.) is betartva fogják kezelni. Hozzájárulok   ahhoz,   hogy   a   vizsgálathoz   szükséges   személyes   adataimat, valamint a vizsgálat során rólam nyert adatokat a kísérletet végzők egymástól elkülönítve rögzítsék, azokat egymástól elkülönítve, elektronikus úton tárolják, és kutatási   célból   felhasználják,   úgy,   hogy   harmadik   fél   részére   személyem azonosítására alkalmas információt nem szolgáltatnak ki. Hozzájárulok, hogy anonimizált, személyes beazonosításomra nem alkalmas adataimat a tudományos közösséggel megosszák a https://osf.io/ (Open Science Foundation [magyarul: Nyílt Tudomány Alapítvány]) és a https://openneuro.org/ (OpenNeuro) szerverein.</p>`
    var consent_text = `<h1 style="color:${text_color}">Tájékoztató és beleegyező nyilatkozat</h1><p style="color:${text_color}">Ez a kérdőív névtelen. A kérdőívre adott válaszokkal együtt nem rögzítünk semmilyen Önnel kapcsolatos azonosító információt, csak akkor, ha kimondottan ilyen adatra vonatkozó kérdésre válaszol a kérdőívben. Ha azonosító kitöltésjelszót használt ennek a kérdőívnek az eléréséhez, megnyugodhat, hogy ezt a kitöltésjelszót a válaszoktól elkülönítetten kezeljük. A kitöltésjelszót külön adatbázisban tároljuk, és csak azt jelzi, hogy a kitöltése befejeződött ill. még nem fejeződött be. A kitöltésjelszó semmilyen módon sem kapcsolható össze a kérdőív kérdéseire adott válaszokkal.</p><h2 style="color:${text_color}">ADATKEZELÉSI TÁJÉKOZTATÓ </h2><p style="color:${text_color}">A   beleegyező   nyilatkozat   az   EU   2016/679.   számú   általános   adatvédelmi   rendelete [GDPR], valamint az információs önrendelkezési jogról és az információszabadságról szóló 2011. évi CXII. törvény rendelkezései alapján lett összeállítva. Elfogadásával a GDPR preambulum (32)-(33), 4. cikk 11. pont, 6. cikk (1)a) pont alapján hozzájárul ahhoz, hogy azon személyes adatai, amelyek az elérhetőségét biztosítják a vizsgálat   elvégzéséig   (teljes   név,   telefonszám   és   e-mail   cím),   valamint   speciális egészségügyi adatai a törvényi előírásoknak megfelelően tárolásra kerüljenek. Személyes adatok   a   résztvevők   toborzásának   folyamatához   szükségesek,   az   esetleges későbbi vizsgálatok és azok eredményei anonim módon lesznek tárolva. Személyes adataihoz csak a titoktartási megállapodást elfogadó adatkezelők férhetnek hozzá, ameddig a teljes adat nem lesz anonimizálható. A   beleegyező   nyilatkozat   elfogadásával   továbbá   hozzájárul   ahhoz,   hogy   a   későbbi vizsgálat során végzett tesztek eredményei anonim módon rögzítésre kerüljenek, azt az illetékesek elektronikus úton tárolják, és kutatási célból felhasználják úgy, hogy harmadik fél   részére   személye   azonosítására   alkalmas   információt   nem   szolgáltatnak   ki. Anonimizált, személyes beazonosításra nem alkalmas adatai a tudományos közösség számára publikussá válnak a https://osf.io/  (Open Science Foundation [magyarul: Nyílt Tudomány Alapítvány]) és a https://openneuro.org/ (OpenNeuro) szerverein. A beleegyező nyilatkozatban kifejezett hozzájárulás bármikor visszavonható, amely tény nem érinti a visszavonás előtti adatkezelés jogszerűségét. A nyilvántartott személyes adatokhoz bármikor hozzáférhet, azok helyesbítését és törlését joggal kérvényezheti (GDPR 3/3/17). Továbbá jogosult arra, hogy az adatkezelőtől visszajelzést kapjon arra vonatkozóan,   hogy   személyes   adatainak   kezelése   folyamatban   van-e,   és   ha   ilyen adatkezelés folyamatban van, jogosult arra, hogy a személyes adatokhoz és a következő információkhoz   hozzáférést   kap  (GDPR 2/15/1). Kérésére   az  adatkezelő   indokolatlan késedelem nélkül helyesbíti a rá vonatkozó pontatlan személyes adatokat. Figyelembe véve az adatkezelés célját, jogosult arra, hogy kérje a hiányos személyes adatok – egyebek mellett kiegészítő nyilatkozat útján történő – kiegészítését is (GDPR 3/3/16). Adatvédelmi   panasz   esetén   joggal   fordulhat   a   Nemzeti   Adatvédelmi   és Információszabadság Hatósághoz (http://naih.hu postacím: 1530 Budapest, Pf.: 5., e-mail: ugyfelszolgalat@naih.hu, telefonszám: +36 (1) 391-1400). A fő adatkezelő elérhetősége és adatai: Név: Dr. Keresztes Attila Intézmény: Agyi Képalkotó Központ, Természettudományi Kutatóközpont Telefonszám: +36 1 3826903 E-mail cím: keresztes.attila.akk@ttk.hu </p>`
    var data_text = `<h2 style="color:${text_color}">BELEEGYEZŐ NYILATKOZAT </h2><p style="color:${text_color}">A kérdőívvel és az adatkezeléssel kapcsolatban minden számomra fontos információt megkaptam, a tájékoztatót elolvastam. A kérdőívet önszántamból, saját felelősségemre töltöm ki. Kérjük,  olvassa   el  az   alábbi   állításokat!   Amennyiben   egyetért   velük, jelölje   meg  az állítások alatt található négyzetet. Tudomásul  veszem,  hogy  a  kitöltés bármikor,  indoklás  nélkül, akár  végleg   is megszakítható,   és   ebben   az   esetben   a   megadott   adatok   nem   kerülnek feldolgozásra. Tudomásul veszem, hogy adataimat a 2018. május 25-től hatályos 2016/679/EU Európai Unió általános adatvédelmi irányelvét és a magyarországi jogszabályokat (2011. évi CXII. adatvédelmi tv.) is betartva fogják kezelni. Hozzájárulok   ahhoz,   hogy   a   vizsgálathoz   szükséges   személyes   adataimat, valamint a vizsgálat során rólam nyert adatokat a kísérletet végzők egymástól elkülönítve rögzítsék, azokat egymástól elkülönítve, elektronikus úton tárolják, és kutatási   célból   felhasználják,   úgy,   hogy   harmadik   fél   részére   személyem azonosítására alkalmas információt nem szolgáltatnak ki. Hozzájárulok, hogy anonimizált, személyes beazonosításomra nem alkalmas adataimat a tudományos közösséggel megosszák a https://osf.io/ (Open Science Foundation [magyarul: Nyílt Tudomány Alapítvány]) és a https://openneuro.org/ (OpenNeuro) szerverein.</p>`
    
    var consent = {
      //TODO button label
      type: 'survey-multi-choice',
      questions: [
        {prompt: consent_text_complete, name:'Consent', options: ['Elfogadom', 'Nem fogadom el'], required:true, horizontal: true},
        //{prompt: data_text, name: 'Consent', options: ['Elfogadom', 'Nem fogadom el'], required:true}
      ],
      button_label: 'Folytatás',
    };

    var rip = {
      type: "html-keyboard-response",
      stimulus: '<h1 style="color:' + text_color + '">Köszönjük!</h1><h1 style="color:' + text_color + '">Bezárhatja az ablakot.</h1>',
    }

    var fullscreen = {
      type: 'fullscreen',
      message: '<p style="color:' + text_color + '">A kísérlet teljes képernyős módra vált. Nyomja meg a gombot a folytatáshoz!</p>',
      button_label: 'Folytatás',
      fullscreen_mode: true,
    };

    var trial_instruction1 = {
      type: 'instructions',
      pages: ['<h1 style="color:' + text_color + '"> Üdvözöljük a kísérletben!</h1> <p style="color:' + text_color + '"> A következőkben egy memória játékot fog játszani. 25db lefordított kártyát fogunk mutatni. Ezután egy kártyát rövid időre felfordítunk, így láthatja milyen tárgyat ábrázol. Ezután újabb kártyákat fordítunk fel. Jegyezze meg a felfordított kártyán lévő képet.</p> <p style="color:' + text_color + '">Először 3 kártyát mutatunk meg gyakorlásképp. Ha készen áll, nyomja meg a "Folytatás" gombot. </p>"'],
      show_clickable_nav: true,
      button_label_next: 'Folytatás',
      allow_backward: false,
      on_finish: function() {
        //console.log("trial_instruction1")
      },
    }
    var trial_instruction2 = {
      type: 'instructions',
      pages: ['<p style="color:' + text_color + '">Miután megjegyzte a felfordított kártyákat, új kártyákat fogunk mutatni a lefordított kártyák fölött. Mindegyikről megkérdezzük, hogy látta-e már.</p><p style="color:' + text_color + '">Ha a válasz <b>igen, kattintson az "Igen" gombra."</b></p> <p style="color:' + text_color + '"> Ha a válasz <b>nem, kattintson a "Nem" gombra.</b></p><p style="color:' + text_color + '">Majd megkérdezzük, hogy hol látta a kártyát. Ekkor csak kattintson a megfelelő kártyára.</p>'],
      show_clickable_nav: true,
      button_label_next: 'Folytatás',
      allow_backward: false,
    } 

    var trial_instruction3 = {
      type: 'instructions',
      pages: ['<p style="color:' + text_color + '">A játék pontosan úgy működik, ahogy az imént gyakoroltuk, azzal a különbséggel, hogy most 12 kártyát fogunk felfordítani. Ismételten meg kell jegyeznie azokat a kártyákat ahol a kép megjelenik. Ha készen áll, nyomja meg a "Folytatás" gombot. </p>'],
      show_clickable_nav: true,
      button_label_next: 'Folytatás',
      allow_backward: false,
    }
    var trial_instruction4 = {
      type: 'instructions',
      pages: ['<p style="color:' + text_color + '">Most még egy kör gyakorlás következik. Ha készen áll, nyomja meg a "Folytatás" gombot. </p>'],
      show_clickable_nav: true,
      button_label_next: 'Folytatás',
      allow_backward: false,
    }

    var trial_instruction_maths = {
      type: 'instructions',
      pages: [`<p style="color:${text_color}">Most egy más fajta feladat következik. A képernyőn egyszerű összeadási feladatokat fog látni.</p><p style="color:${text_color}"> Írja be az összeadások eredményét a szövegdobozba a billentyűzet segítségével, majd kattintson a tovább gombra.</p><p style="color:${text_color}"> Ha készen áll, nyomja meg a "Folytatás" gombot. </p>`],
      show_clickable_nav: true,
      button_label_next: 'Folytatás',
      allow_backward: false,
    }

    var trial_memorise = {

        type: 'psychophysics',
        stimuli: [gray, img_memorise],
        background_color: 'black',
        response_type: 'mouse',
        response_start_time: 0,
        data: {type: 'trial_memorise'},
        trial_duration: 3000,
        canvas_offsetY: 0,
    }

    var trial_recall = {
        type: 'psychophysics',
        stimuli: [gray, img_recall, text_seen],
        canvas_height: window.innerHeight*1, //Modify this to position the buttons
        background_color: 'black',
        response_type: 'button',
        button_choices: ['Láttam', 'Nem láttam'],
        vert_button_margin: '0px',
        horiz_button_margin: '100px',
        response_start_time: 0,
        trial_duration: 30000,
        data: {type: 'trial_recall'},
        on_finish: function(data){
          //if (data.button_press)
          //data.button_press = event.button;
          data.correct_response = jsPsych.timelineVariable('was', true)
          data.correct = data.button_pressed == data.correct_response
          data.correct_recall = data.correct;
          //console.log(data)

        }
    }

    var trial_position = {
        type: 'psychophysics',
        stimuli: [gray, img_recall, text_where],
        canvas_height: window.innerHeight*1,
        background_color: 'black',
        response_type: 'mouse',
        response_start_time: 0,
        trial_duration: 30000,
        data: {type: 'trial_position'},
        on_finish: function(data){
          data.positionLeft = jsPsych.timelineVariable('left_X', true);
          data.positionRight = jsPsych.timelineVariable('right_X', true);
          data.positionTop = jsPsych.timelineVariable('top_Y', true);
          data.positionBottom = jsPsych.timelineVariable('bottom_Y', true);
          data.correct = data.click_x > data.positionLeft && data.click_x < data.positionRight && data.click_y < data.positionBottom && data.click_y > data.positionTop
          data.correct_position = data.correct;
        }
    }

    var if_node ={
      timeline: [trial_position],
      conditional_function: function(){
        var data = jsPsych.data.get().last(1).values()[0];
        if (data.button_pressed == 0){
          return true;
        } else {
          return false;
        }
      }
    }

    var trial_feedback = {
      type: 'psychophysics',
      stimuli: [text_feedback],
      background_color: 'black',
      response_type: 'mouse',
      response_start_time: 0,
      data: {type: 'trial_feedback'},
    }

    /*var distractor_maths = {
      type: 'survey-text',
      questions: [
        {prompt: jsPsych.timelineVariable('num_1', true) + ' + ' + jsPsych.timelineVariable('num_2') + ' = ', name: "math_question"}, 
      ],
    }*/

    var distractor_maths = {
      type: 'survey-html-form',
      preamble: `<h1 style="color:${text_color}"> Mi az eredmény?</h1>`,
      html: function() {
        var text_color = 'white'
        var num_1 = jsPsych.timelineVariable('num_1', true)
        var num_2 = jsPsych.timelineVariable('num_2', true)
        var text = `<h2 style="color:${text_color}"> ${num_1} + ${num_2} = <input type="text" id="test-resp-box" name="response" size="10" /></h2>`
        return text;
      },
      required: true,
      button_label: "Tovább",
    }
    //Trial blocks

    var trials_practice_memorize_1 = {
      timeline: [trial_memorise],
      timeline_variables: practice_picture_list_1,
    }
   
    var trials_practice_recall_1 = {
      timeline: [trial_recall, if_node],
      timeline_variables: practice_recall_list_1,
    }
    var trials_practice_memorize_2 = {
      timeline: [trial_memorise],
      timeline_variables: practice_picture_list_2,
    }
   
    var trials_practice_recall_2 = {
      timeline: [trial_recall, if_node],
      timeline_variables: practice_recall_list_2,
    }

    var trials_memorise = {
      timeline: [trial_memorise],
      timeline_variables: picture_list,
    }

    var trials_recall = {
      timeline: [trial_recall, if_node],
      timeline_variables: recall_list,
    }

    var trials_maths = {
      timeline: [distractor_maths],
      timeline_variables: maths_list,
    }

    // exit fullscreen mode
    var fullscreen_end = {
      type: 'fullscreen',
      fullscreen_mode: false
    }

    var preload = {
      type: 'preload',
      auto_preload: true,
      images: all_images,
      show_progress_bar: true,
    }

    //timeline.push(preload)
    timeline.push(fullscreen);
    timeline.push(consent);

    var consented = {
      timeline: [trial_instruction1, trials_practice_memorize_1, trial_instruction2, trials_practice_recall_1, trial_feedback, trial_instruction4, trials_practice_memorize_2, trial_instruction2, trials_practice_recall_2, trial_feedback, trial_instruction3, trials_memorise, trial_instruction_maths, trials_maths, trials_recall, fullscreen_end, rip],
      conditional_function: function(){
        var data = jsPsych.data.get().last(1).values()[0];
        if (data.response.Consent == 'Elfogadom'){
          return true;
        } else {
          return false;
        }
      },
    }
    timeline.push(consented);

    var didnt_consent = {
      timeline: [rip],
      conditional_function: function(){
        var data = jsPsych.data.get().last(1).values()[0];
        if (data.response.Consent == "Nem fogadom el"){
          return true;
        } else {
          return false;
        }
      }
    }
    timeline.push(didnt_consent);


    //timeline.push(fullscreen_end)
    console.log(timeline)
    /*function startExperiment(){
      jsPsych.init({
        timeline: timeline,
        use_webaudio: 'false', 
        override_safe_mode: 'true',
        //on_finish: function(){jsPsych.data.displayData();}
      });
    }*/

    jsPsych.init({
        timeline: timeline,
        use_webaudio: 'false', 
        override_safe_mode: 'true',
        //on_finish: function(){jsPsych.data.displayData();}
    });
</script>
</html>
